### redis持久化详解

在redis中提供了两种持久化方式RDB（快照）和AOF，不过两种各有利弊，接下来详细说一下。

#### 1. RDB持久化方式

RBD持久化是redis的默认策略。

redis回生成一个二进制文件，默认情况下dump.rdb会叫这个名字，但这个文件是可以被redis还原成文件生成时redis的状态。

1. 生成RDB文件
redis支持两个命令生成RDB文件，```SAVE```和```BGSAVE```，主要区别在一前者为阻塞方式生成文件，在redis数据量特别大时，会一直阻塞不会相应任何请求。
后者则是以子进程的方式进行生成文件，也就以为这不会产生阻塞。

** 若在BGSAVE执行期间，手动再次调用```SAVE```、```BGSAVE```或```BGREWRITEAOF```命令会产生两次备份么？**

redis规定在备份命令执行期间，再次执行以上命令则不会被执行，为了防止产生竞争同时执行两个```rdbSave```，```SAVE```、```BGSAVE```两个命令不会执行。
而```BGREWRITEAOF```命令会在，前一个命令执行完成后开始执行。

但如果是```BGREWRITEAOF```命令正在执行，此时客户端发送```BGSAVE```命令则会被拒绝。

具体原因是两个命令都是由子进程执行的，所以在操作方面没有冲突的地方，不能同时执行的原因是性能上的考虑——并发出两个子进程，并且这两个子进程都会同时执行大量 io（磁盘写入）操作
2. redis恢复RDB文件
